<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">
    <title>03</title>
</head>
<body>

<p>UNREGISTER A SW</p>
<output></output>


<button onclick="unregister()" style="font-size: 24px;">Unregister</button>

<p>UNREGISTER deletes it and makes it redundant</p>
<script>

function unregister() {
    console.log("UNREGISTER");
    navigator.serviceWorker.getRegistration()
        .then(registration => {
            console.log(registration)
            registration.unregister();
        });
        
}

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register("sw03.js",
        { scope: "./" })
        .then( registration => {
            console.log(registration)
            const scope = registration.scope;
            document.querySelector("output").innerHTML = 
                `<p>Service Worker registered properly at ${scope}</p>`;
        })
        .catch( error => {
            document.querySelector("output").innerHTML = 
                "<p>Service Worker NOT registered</p>";
        });
} else {
    document.querySelector("output").innerHTML = 
                "<p>Service Worker NOT available</p>";
}

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistration()
        .then( registration => {
            registration.addEventListener("updatefound", event => {
                const swInstalling = registration.installing;
                swInstalling.addEventListener("statechange", () => {
                    if (swInstalling.state=='installed') {
                        document.querySelector("output").innerHTML = 
                "A new Service Worker is installed and waiting";                        
                    } else {
                        document.querySelector("output").innerHTML = 
                "A new Service Worker is now controlling the page";
                    }
                });
            });
        })
        .catch( error => {

        });
}


</script>
</body>
</html>