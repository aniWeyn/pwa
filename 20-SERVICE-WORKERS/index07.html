<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>07</title>
</head>

<body>
    <p>Initially gives SW message but on refresh once SW is activated, it will give detailed response unless 'api' in URL, in which case it gives a custom response.</p>
    <p>07 if api in url gives a custom Response</p>
    <p>Otherwise gives detailed info on REQUEST</p>
    // https://www.w3schools.com/jsref/jsref_includes.asp <br>
    // https://www.w3schools.com/jsref/jsref_indexof.asp<br>
    // https://www.w3schools.com/jsref/jsref_startswith.asp<br>
    // https://www.w3schools.com/jsref/jsref_obj_regexp.asp<br><br>
    <output></output>
   
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register("sw07.js", {
                    scope: "./"
                })
                .then(registration => {
                    const scope = registration.scope;
                    document.querySelector("output").innerHTML =
                        `Service Worker registered properly at ${scope}`;
                })
                .catch(error => {
                    document.querySelector("output").innerHTML =
                        "Service Worker NOT registered";
                });
        } else {
            document.querySelector("output").innerHTML =
                "Service Worker NOT available";
        }
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistration()
                .then(registration => {
                    registration.addEventListener("updatefound", event => {
                        const swInstalling = registration.installing;
                        swInstalling.addEventListener("statechange", () => {
                            if (swInstalling.state == 'installed') {
                                document.querySelector("output").innerHTML =
                                    "A new Service Worker is installed and waiting";
                            } else {
                                document.querySelector("output").innerHTML =
                                    "A new Service Worker is now controlling the page. <br> To view the new Response we need to reload page.";
                            }
                        });
                    });
                })
                .catch(function (error) {
                    console.log(error);
                });
        }
    </script>
</body>

</html>